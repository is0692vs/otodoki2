# `backend/app/db/` ディレクトリの AGENT ルール

このディレクトリは、データベースアクセス層を担当します。SQLAlchemy/SQLModel による ORM 定義、データベースセッション管理、Alembic マイグレーション設定などをここに配置します。

## 構造と役割

- `session.py`: 非同期エンジンとセッションファクトリ (`AsyncSessionMaker`) の定義。FastAPI からの依存性注入にも使用します。
- `migrations/`: Alembic のマイグレーションスクリプトおよび設定が格納されます。
- `models.py` (新規作成予定): SQLModel ベースのテーブル定義を配置します。
- `crud/` (新規作成予定): データ操作用の CRUD ファサードを配置します。

## AI エージェントへの指示

- 新しいテーブルや関係を追加する場合は `models.py` に SQLModel の宣言を追加し、Alembic マイグレーションを更新してください。
- データアクセスロジックは `crud/` 以下にモジュール化し、ドメインごとにファイル分割することを推奨します。
- セッション生成や後処理は `session.py` 経由で行い、直接エンジンにアクセスしないようにしてください。
- マイグレーション作業後は `alembic revision --autogenerate` で差分を確認し、不要な変更が含まれていないかチェックしてください。
